<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>UPI Payment — Ecommerit</title>
  <style>
    :root{--bg:#f6f8fb;--card:#fff;--muted:#6b7280;--green:#16a34a}
    body{font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif;margin:0;background:var(--bg);color:#111}
    .wrap{max-width:820px;margin:28px auto;padding:16px}
    .card{background:var(--card);border-radius:12px;padding:18px;margin-bottom:14px;box-shadow:0 6px 18px rgba(20,20,50,.05)}
    h1{margin:0 0 6px;font-size:22px}
    p{margin:6px 0 12px;color:var(--muted)}
    .grid{display:grid;gap:12px}
    @media(min-width:720px){.grid{grid-template-columns:1fr 1fr}}
    .qr{width:260px;height:260px;border-radius:10px;border:8px solid #fff;display:block;box-shadow:0 6px 18px rgba(0,0,0,.06)}
    label{display:block;font-size:13px;margin-top:8px;color:var(--muted)}
    input[type="number"], input[type="text"]{width:100%;padding:10px;border-radius:8px;border:1px solid #e4e8f0;margin-top:6px}
    .btn{display:inline-block;padding:10px 14px;border-radius:8px;border:none;font-weight:600;cursor:pointer}
    .btn.primary{background:var(--green);color:#fff}
    .btn.ghost{background:#f3f6fb;border:1px solid #e6eef7;color:#0b1220}
    .muted{color:var(--muted);font-size:13px;margin-top:8px}
    .small{font-size:12px;color:var(--muted)}
    .row{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>UPI Payment</h1>
      <p>Pay securely with any UPI app (GPay / PhonePe / Paytm). Update amount & note, then scan or tap the Open button on mobile.</p>

      <div class="grid">
        <div>
          <h3 style="margin:0 0 10px">Scan to Pay</h3>
          <img id="qrImg" class="qr" src="" alt="UPI QR code">
          <div class="muted small">UPI ID: <strong id="upiIdText">nidakhan@upi</strong></div>
          <div class="row">
            <button class="btn ghost" id="copyBtn">Copy UPI ID</button>
            <a id="downloadQr" class="btn ghost" href="#" download="upi-qr.png">Download QR</a>
          </div>
        </div>

        <div>
          <h3 style="margin:0 0 10px">Pay with UPI App</h3>

          <label>UPI ID</label>
          <input id="upiId" type="text" value="nidakhan@upi">

          <label>Payee name (optional)</label>
          <input id="payeeName" type="text" value="Ecommerit">

          <label>Amount (INR)</label>
          <input id="amount" type="number" min="1" step="1" placeholder="100">

          <label>Note / Order ID</label>
          <input id="note" type="text" placeholder="Order #1234">

          <div class="row">
            <button class="btn primary" id="openBtn">Open in UPI App</button>
            <button class="btn ghost" id="updateBtn">Update Link & QR</button>
          </div>

          <div class="muted small" style="margin-top:12px">
            Deep link: <code id="upiLink" style="display:block;word-break:break-all">—</code>
          </div>
        </div>
      </div>
    </div>

    <div class="card small">
      <strong>How to test on mobile:</strong>
      <ol>
        <li>Host this file on your PC and open via your phone using PC's IP (same Wi-Fi), e.g. <code>http://192.168.1.10/upi-payment.html</code>.</li>
        <li>Or upload it to any simple static host (GitHub Pages / Vercel / Netlify).</li>
        <li>Tap <em>Open in UPI App</em> on your phone or scan the QR with a UPI app.</li>
      </ol>
    </div>
  </div>

  <script>
    // Default values
    const defaultUPI = 'nidakhan@upi';
    const defaultPayee = 'Ecommerit';
    const currency = 'INR';

    const upiIdInput = document.getElementById('upiId');
    const payeeInput = document.getElementById('payeeName');
    const amountInput = document.getElementById('amount');
    const noteInput = document.getElementById('note');
    const qrImg = document.getElementById('qrImg');
    const upiLinkEl = document.getElementById('upiLink');
    const upiIdText = document.getElementById('upiIdText');
    const copyBtn = document.getElementById('copyBtn');
    const updateBtn = document.getElementById('updateBtn');
    const openBtn = document.getElementById('openBtn');
    const downloadQr = document.getElementById('downloadQr');

    // Build UPI deep link
    function buildUpiLink(upiId, payee, amt, note){
      const parts = [];
      parts.push('pa=' + encodeURIComponent(upiId));
      if(payee) parts.push('pn=' + encodeURIComponent(payee));
      parts.push('cu=' + encodeURIComponent(currency));
      if(amt) parts.push('am=' + encodeURIComponent(amt));
      if(note) parts.push('tn=' + encodeURIComponent(note));
      return 'upi://pay?' + parts.join('&');
    }

    // Update QR using Google Chart API (no server)
    function updateAll(){
      const upiId = (upiIdInput.value || defaultUPI).trim();
      const payee = (payeeInput.value || defaultPayee).trim();
      const amt = (amountInput.value || '').trim();
      const note = (noteInput.value || '').trim();

      const upiLink = buildUpiLink(upiId, payee, amt || null, note || null);
      // Show deep link
      upiLinkEl.textContent = upiLink;
      upiIdText.textContent = upiId;

      // Google Chart QR API
      const qrData = encodeURIComponent(upiLink);
      const qrUrl = 'https://chart.googleapis.com/chart?chs=300x300&cht=qr&chl=' + qrData;
      qrImg.src = qrUrl;
      downloadQr.href = qrUrl;
      openBtn.href = upiLink; // anchor-style open
      // For desktop browsers, clicking the upi:// link may do nothing. Test on mobile.
    }

    // Copy UPI ID
    copyBtn.addEventListener('click', () => {
      const text = (upiIdInput.value || defaultUPI).trim();
      navigator.clipboard.writeText(text).then(()=> {
        copyBtn.textContent = 'Copied!';
        setTimeout(()=> copyBtn.textContent = 'Copy UPI ID', 1400);
      });
    });

    // Update button
    updateBtn.addEventListener('click', (e)=> {
      e.preventDefault();
      updateAll();
    });

    // Open button - works on mobile apps when clicked
    openBtn.addEventListener('click', (e) => {
      const upiLink = upiLinkEl.textContent;
      // try to open deep link normally by setting location
      window.location.href = upiLink;
      // fallback: after a short delay, open the QR or show message (handled by user)
    });

    // initialize on load
    updateAll();
  </script>
</body>
</html>
